/**
 * ==============================================================================
 * This product contains a modified version of 'TensorBoard plugin for graphs',
 * a Angular implementation of nest-graph visualization
 *
 * Copyright 2018 The ng-zorro-plus Authors. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ==============================================================================
 */
import * as dagre from 'dagre';
import { runAsyncTask } from './util';
import { InclusionType, NodeType, GraphType, NAMESPACE_DELIM } from './interface';
var Graph = dagre.graphlib.Graph;
/** @type {?} */
export var EDGE_KEY_DELIM = '--';
export class BaseNode{
  constructor(rawNode) {
        this.name = rawNode.name;
        this.attr = rawNode.attr;
        this.inputs = rawNode.inputs;
        this.cardinality = 1;
        this.include = InclusionType.UNSPECIFIED;
        this.isGroupNode = false;
        this.parentNode = null;
        this.type = NodeType.OP;
    }
};

export class SlimGraph{
  constructor() {
        this.nodes = {};
        this.edges = [];
    }
}


export function addEdgeToGraph(graph, outputNode, input) {
    if (input.name === outputNode.name) {
        return;
    }
    graph.edges.push({ ...input.attr,  v: input.name, w: outputNode.name });
}

export function buildDef(graphDef) {
    return runAsyncTask(function () {
        /** @type {?} */
        var graph = new SlimGraph();
        /** @type {?} */
        var graphNodes = graphDef.nodes.map(function (node) { return new BaseNode(node); });
        graphNodes.forEach(function (node) {
            graph.nodes[node.name] = node;
            node.inputs.forEach(function (input) {
                addEdgeToGraph(graph, node, input);
            });
        });
        return graph;
    });
}
export  class MetanodeImpl{
  constructor(name, opt) {
        if (opt === void 0) { opt = {}; }
        this.name = name;
        this.type = NodeType.META;
        this.depth = 1;
        this.isGroupNode = true;
        this.cardinality = 0;
        this.metagraph = createGraph(name, GraphType.META, opt);
        this.bridgegraph = null;
        this.opHistogram = {};
        this.deviceHistogram = {};
        this.xlaClusterHistogram = {};
        this.compatibilityHistogram = { compatible: 0, incompatible: 0 };
        /** unique id for a metanode of similar subgraph */
        this.templateId = null;
        /** Metanode which contains this node, if any */
        this.parentNode = null;
        this.hasNonControlEdges = false;
        this.include = InclusionType.UNSPECIFIED;
        this.associatedFunction = '';
    }
    /**
     * @return {?}
     */
    getFirstChild = () => {
        return this.metagraph.node(this.metagraph.nodes()[0]);
    };
    /**
     * @return {?}
     */
    getChildren = () => {
        var _this = this;
        return this.metagraph.nodes().map(function (node) { return _this.metagraph.node(node); });
    };
    /**
     * @return {?}
     */
    getRootOp = () => {
        return undefined;
    };
    /**
     * @return {?}
     */
    leaves = () => {
        return [];
    };
}

export class MetaedgeImpl{
  constructor(v, w) {
        this.v = v;
        this.w = w;
        this.baseEdgeList = [];
        this.inbound = null;
        this.numRegularEdges = 0;
        this.numControlEdges = 0;
        this.numRefEdges = 0;
        this.totalSize = 0;
    }
    /**
     * @param {?} edge
     * @param {?} h
     * @return {?}
     */
    addBaseEdge = (edge, h) => {
        this.baseEdgeList.push(edge);
    };
}

/**
 * @param {?} name
 * @param {?=} opt
 * @return {?}
 */
export function createMetanode(name, opt) {
    if (opt === void 0) { opt = {}; }
    return new MetanodeImpl(name, opt);
}
/**
 * @param {?} v
 * @param {?} w
 * @return {?}
 */
export function createMetaedge(v, w) {
    return new MetaedgeImpl(v, w);
}
/**
 * @param {?} name
 * @return {?}
 */
export function getHierarchicalPath(name) {
    /** @type {?} */
    var path = [];
    /** @type {?} */
    var i = name.indexOf(NAMESPACE_DELIM);
    while (i >= 0) {
        path.push(name.substring(0, i));
        i = name.indexOf(NAMESPACE_DELIM, i + 1);
    }
    path.push(name);
    return path;
}
/**
 * @template N, E
 * @param {?} name
 * @param {?} type
 * @param {?=} opt
 * @return {?}
 */
export function createGraph(name, type, opt) {
    /** @type {?} */
    var graphOptions = opt || {};
    /** @type {?} */
    var graph = new Graph(graphOptions);
    graph.setGraph((/** @type {?} */ ({
        name: name,
        rankdir: graphOptions.rankdir || 'BT',
        // BT,TB,LR,RL
        type: type
    })));
    return ((/** @type {?} */ (graph)));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmctem9ycm8vbmctcGx1cy9ncmFwaC8iLCJzb3VyY2VzIjpbImNvcmUvZ3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRXRDLE9BQU8sRUFPTCxhQUFhLEVBQ2IsUUFBUSxFQUdSLFNBQVMsRUFBRSxlQUFlLEVBQzNCLE1BQU0sYUFBYSxDQUFDO0FBQ3JCLElBQU8sS0FBSyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDOztBQUVwQyxNQUFNLEtBQU8sY0FBYyxHQUFHLElBQUk7QUFHbEM7SUFVRSxrQkFBWSxPQUFnQjtRQUMxQixJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUM3QixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsT0FBTyxHQUFHLGFBQWEsQ0FBQyxXQUFXLENBQUM7UUFDekMsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFDSCxlQUFDO0FBQUQsQ0FBQyxBQXBCRCxJQW9CQzs7OztJQWxCQyx3QkFBYzs7SUFDZCwwQkFBdUI7O0lBQ3ZCLHdCQUFhOztJQUNiLCtCQUFvQjs7SUFDcEIsMkJBQXVCOztJQUN2QiwrQkFBcUI7O0lBQ3JCLDhCQUFpQjs7SUFDakIsd0JBQWU7O0FB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ckIsWUFBWSxHQUFHLEdBQUcsSUFBSSxFQUFFOztRQUN4QixLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDO0lBQ3JDLEtBQUssQ0FBQyxRQUFRLENBQUMsbUJBQUE7UUFDYixJQUFJLEVBQUUsSUFBSTtRQUNWLE9BQU8sRUFBRSxZQUFZLENBQUMsT0FBTyxJQUFJLElBQUk7O1FBQ3JDLElBQUksRUFBRSxJQUFJO0tBQ1gsRUFBeUIsQ0FBQyxDQUFDO0lBQzVCLE9BQU8sQ0FBQyxtQkFBQSxLQUFLLEVBQU8sQ0FBQyxDQUFDO0FBQ3hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogVGhpcyBwcm9kdWN0IGNvbnRhaW5zIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiAnVGVuc29yQm9hcmQgcGx1Z2luIGZvciBncmFwaHMnLFxuICogYSBBbmd1bGFyIGltcGxlbWVudGF0aW9uIG9mIG5lc3QtZ3JhcGggdmlzdWFsaXphdGlvblxuICpcbiAqIENvcHlyaWdodCAyMDE4IFRoZSBuZy16b3Jyby1wbHVzIEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgJ0xpY2Vuc2UnKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi9cbi8vIHRzbGludDpkaXNhYmxlXG5cbmltcG9ydCAqIGFzIGRhZ3JlIGZyb20gJ2RhZ3JlJztcbmltcG9ydCB7IHJ1bkFzeW5jVGFzayB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgeyBIaWVyYXJjaHkgfSBmcm9tICcuL2hpZXJhcmNoeSc7XG5pbXBvcnQge1xuICBBdHRyRGVmLFxuICBCYXNlRWRnZSxcbiAgR3JhcGhEZWYsXG4gIE5vZGVEZWYsXG4gIE5vZGVJbnB1dERlZixcbiAgTm9kZSxcbiAgSW5jbHVzaW9uVHlwZSxcbiAgTm9kZVR5cGUsXG4gIE1ldGFub2RlLFxuICBHcm91cE5vZGUsXG4gIEdyYXBoVHlwZSwgTkFNRVNQQUNFX0RFTElNLCBNZXRhZWRnZVxufSBmcm9tICcuL2ludGVyZmFjZSc7XG5pbXBvcnQgR3JhcGggPSBkYWdyZS5ncmFwaGxpYi5HcmFwaDtcblxuZXhwb3J0IGNvbnN0IEVER0VfS0VZX0RFTElNID0gJy0tJztcblxuXG5leHBvcnQgY2xhc3MgQmFzZU5vZGUgaW1wbGVtZW50cyBOb2RlRGVmLCBOb2RlIHtcblxuICBhdHRyOiBBdHRyRGVmO1xuICBpbnB1dHM6IE5vZGVJbnB1dERlZltdO1xuICBuYW1lOiBzdHJpbmc7XG4gIGNhcmRpbmFsaXR5OiBudW1iZXI7XG4gIGluY2x1ZGU6IEluY2x1c2lvblR5cGU7XG4gIGlzR3JvdXBOb2RlOiBib29sZWFuO1xuICBwYXJlbnROb2RlOiBOb2RlO1xuICB0eXBlOiBOb2RlVHlwZTtcbiAgY29uc3RydWN0b3IocmF3Tm9kZTogTm9kZURlZikge1xuICAgIHRoaXMubmFtZSA9IHJhd05vZGUubmFtZTtcbiAgICB0aGlzLmF0dHIgPSByYXdOb2RlLmF0dHI7XG4gICAgdGhpcy5pbnB1dHMgPSByYXdOb2RlLmlucHV0cztcbiAgICB0aGlzLmNhcmRpbmFsaXR5ID0gMTtcbiAgICB0aGlzLmluY2x1ZGUgPSBJbmNsdXNpb25UeXBlLlVOU1BFQ0lGSUVEO1xuICAgIHRoaXMuaXNHcm91cE5vZGUgPSBmYWxzZTtcbiAgICB0aGlzLnBhcmVudE5vZGUgPSBudWxsO1xuICAgIHRoaXMudHlwZSA9IE5vZGVUeXBlLk9QO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTbGltR3JhcGgge1xuICBub2RlczogeyBbbm9kZU5hbWU6IHN0cmluZ106IEJhc2VOb2RlIH07XG4gIGVkZ2VzOiBCYXNlRWRnZVtdO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMubm9kZXMgPSB7fTtcbiAgICB0aGlzLmVkZ2VzID0gW107XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZEVkZ2VUb0dyYXBoKGdyYXBoOiBTbGltR3JhcGgsIG91dHB1dE5vZGU6IEJhc2VOb2RlLCBpbnB1dDogTm9kZUlucHV0RGVmKSB7XG4gIGlmIChpbnB1dC5uYW1lID09PSBvdXRwdXROb2RlLm5hbWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBncmFwaC5lZGdlcy5wdXNoKHtcbiAgICAuLi5pbnB1dC5hdHRyLFxuICAgIHY6IGlucHV0Lm5hbWUsXG4gICAgdzogb3V0cHV0Tm9kZS5uYW1lXG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGREZWYoZ3JhcGhEZWY6IEdyYXBoRGVmKTogUHJvbWlzZTxTbGltR3JhcGg+IHtcbiAgcmV0dXJuIHJ1bkFzeW5jVGFzaygoKSA9PiB7XG4gICAgY29uc3QgZ3JhcGggPSBuZXcgU2xpbUdyYXBoKCk7XG4gICAgY29uc3QgZ3JhcGhOb2RlcyA9IGdyYXBoRGVmLm5vZGVzLm1hcChub2RlID0+IG5ldyBCYXNlTm9kZShub2RlKSk7XG4gICAgZ3JhcGhOb2Rlcy5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgZ3JhcGgubm9kZXNbbm9kZS5uYW1lXSA9IG5vZGU7XG4gICAgICBub2RlLmlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgYWRkRWRnZVRvR3JhcGgoZ3JhcGgsIG5vZGUsIGlucHV0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGdyYXBoO1xuICB9KTtcbn1cblxuZXhwb3J0IGNsYXNzIE1ldGFub2RlSW1wbCBpbXBsZW1lbnRzIE1ldGFub2RlIHtcbiAgYXNzb2NpYXRlZEZ1bmN0aW9uOiBzdHJpbmc7XG4gIGF0dHI6IEF0dHJEZWY7XG4gIGJyaWRnZWdyYXBoOiBncmFwaGxpYi5HcmFwaDxHcm91cE5vZGUgfCBCYXNlTm9kZSwgTWV0YWVkZ2U+O1xuICBjYXJkaW5hbGl0eTogbnVtYmVyO1xuICBjb21wYXRpYmlsaXR5SGlzdG9ncmFtOiB7IGNvbXBhdGlibGU6IG51bWJlcjsgaW5jb21wYXRpYmxlOiBudW1iZXIgfTtcbiAgZGVwdGg6IG51bWJlcjtcbiAgZGV2aWNlSGlzdG9ncmFtOiB7IFsgcDogc3RyaW5nIF06IG51bWJlciB9O1xuICBoYXNOb25Db250cm9sRWRnZXM6IGJvb2xlYW47XG4gIGluY2x1ZGU6IEluY2x1c2lvblR5cGU7XG4gIGlzR3JvdXBOb2RlOiBib29sZWFuO1xuICBtZXRhZ3JhcGg6IGdyYXBobGliLkdyYXBoPEdyb3VwTm9kZSB8IEJhc2VOb2RlLCBNZXRhZWRnZT47XG4gIG5hbWU6IHN0cmluZztcbiAgb3BIaXN0b2dyYW06IHsgWyBwOiBzdHJpbmcgXTogbnVtYmVyIH07XG4gIHBhcmVudE5vZGU6IE5vZGU7XG4gIHRlbXBsYXRlSWQ6IHN0cmluZztcbiAgdHlwZTogTm9kZVR5cGU7XG4gIHhsYUNsdXN0ZXJIaXN0b2dyYW06IHsgWyBwOiBzdHJpbmcgXTogbnVtYmVyIH07XG5cblxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIG9wdCA9IHt9KSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnR5cGUgPSBOb2RlVHlwZS5NRVRBO1xuXG4gICAgdGhpcy5kZXB0aCA9IDE7XG4gICAgdGhpcy5pc0dyb3VwTm9kZSA9IHRydWU7XG4gICAgdGhpcy5jYXJkaW5hbGl0eSA9IDA7XG4gICAgdGhpcy5tZXRhZ3JhcGggPSBjcmVhdGVHcmFwaDxHcm91cE5vZGUgfCBCYXNlTm9kZSwgTWV0YWVkZ2U+KG5hbWUsIEdyYXBoVHlwZS5NRVRBLCBvcHQpO1xuICAgIHRoaXMuYnJpZGdlZ3JhcGggPSBudWxsO1xuICAgIHRoaXMub3BIaXN0b2dyYW0gPSB7fTtcbiAgICB0aGlzLmRldmljZUhpc3RvZ3JhbSA9IHt9O1xuICAgIHRoaXMueGxhQ2x1c3Rlckhpc3RvZ3JhbSA9IHt9O1xuICAgIHRoaXMuY29tcGF0aWJpbGl0eUhpc3RvZ3JhbSA9IHtjb21wYXRpYmxlOiAwLCBpbmNvbXBhdGlibGU6IDB9O1xuICAgIC8qKiB1bmlxdWUgaWQgZm9yIGEgbWV0YW5vZGUgb2Ygc2ltaWxhciBzdWJncmFwaCAqL1xuICAgIHRoaXMudGVtcGxhdGVJZCA9IG51bGw7XG4gICAgLyoqIE1ldGFub2RlIHdoaWNoIGNvbnRhaW5zIHRoaXMgbm9kZSwgaWYgYW55ICovXG4gICAgdGhpcy5wYXJlbnROb2RlID0gbnVsbDtcbiAgICB0aGlzLmhhc05vbkNvbnRyb2xFZGdlcyA9IGZhbHNlO1xuICAgIHRoaXMuaW5jbHVkZSA9IEluY2x1c2lvblR5cGUuVU5TUEVDSUZJRUQ7XG4gICAgdGhpcy5hc3NvY2lhdGVkRnVuY3Rpb24gPSAnJztcbiAgfVxuICBnZXRGaXJzdENoaWxkKCk6IEdyb3VwTm9kZSB8IEJhc2VOb2RlIHtcbiAgICByZXR1cm4gdGhpcy5tZXRhZ3JhcGgubm9kZSh0aGlzLm1ldGFncmFwaC5ub2RlcygpWzBdKTtcbiAgfVxuXG4gIGdldENoaWxkcmVuKCk6IEFycmF5PEdyb3VwTm9kZSB8IEJhc2VOb2RlPiB7XG4gICAgcmV0dXJuIHRoaXMubWV0YWdyYXBoLm5vZGVzKCkubWFwKG5vZGUgPT4gdGhpcy5tZXRhZ3JhcGgubm9kZShub2RlKSk7XG4gIH1cblxuICBnZXRSb290T3AoKTogTm9kZSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGxlYXZlcygpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbn1cblxuZXhwb3J0IGNsYXNzIE1ldGFlZGdlSW1wbCBpbXBsZW1lbnRzIE1ldGFlZGdlIHtcbiAgYmFzZUVkZ2VMaXN0OiBCYXNlRWRnZVtdO1xuICBpbmJvdW5kOiBib29sZWFuO1xuICBuYW1lOiBzdHJpbmc7XG4gIG51bUNvbnRyb2xFZGdlczogbnVtYmVyO1xuICBudW1SZWZFZGdlczogbnVtYmVyO1xuICBudW1SZWd1bGFyRWRnZXM6IG51bWJlcjtcbiAgdG90YWxTaXplOiBudW1iZXI7XG4gIHY6IHN0cmluZztcbiAgdzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHY6IHN0cmluZywgdzogc3RyaW5nKSB7XG4gICAgdGhpcy52ID0gdjtcbiAgICB0aGlzLncgPSB3O1xuICAgIHRoaXMuYmFzZUVkZ2VMaXN0ID0gW107XG4gICAgdGhpcy5pbmJvdW5kID0gbnVsbDtcbiAgICB0aGlzLm51bVJlZ3VsYXJFZGdlcyA9IDA7XG4gICAgdGhpcy5udW1Db250cm9sRWRnZXMgPSAwO1xuICAgIHRoaXMubnVtUmVmRWRnZXMgPSAwO1xuICAgIHRoaXMudG90YWxTaXplID0gMDtcbiAgfVxuXG4gIGFkZEJhc2VFZGdlKGVkZ2U6IEJhc2VFZGdlLCBoOiBIaWVyYXJjaHkpOiB2b2lkIHtcbiAgICB0aGlzLmJhc2VFZGdlTGlzdC5wdXNoKGVkZ2UpO1xuICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1ldGFub2RlKG5hbWU6IHN0cmluZywgb3B0ID0ge30pOiBNZXRhbm9kZSB7XG4gIHJldHVybiBuZXcgTWV0YW5vZGVJbXBsKG5hbWUsIG9wdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNZXRhZWRnZSh2OiBzdHJpbmcsIHc6IHN0cmluZyk6IE1ldGFlZGdlIHtcbiAgcmV0dXJuIG5ldyBNZXRhZWRnZUltcGwodiwgdyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIaWVyYXJjaGljYWxQYXRoKG5hbWU6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgcGF0aDogc3RyaW5nW10gPSBbXTtcbiAgbGV0IGkgPSBuYW1lLmluZGV4T2YoTkFNRVNQQUNFX0RFTElNKTtcblxuICB3aGlsZSAoaSA+PSAwKSB7XG4gICAgcGF0aC5wdXNoKG5hbWUuc3Vic3RyaW5nKDAsIGkpKTtcbiAgICBpID0gbmFtZS5pbmRleE9mKE5BTUVTUEFDRV9ERUxJTSwgaSArIDEpO1xuICB9XG4gIHBhdGgucHVzaChuYW1lKTtcbiAgcmV0dXJuIHBhdGg7XG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUdyYXBoPE4sIEU+KFxuICBuYW1lOiBzdHJpbmcsXG4gIHR5cGUsXG4gIG9wdD86IGdyYXBobGliLkdyYXBoT3B0aW9ucyk6IGdyYXBobGliLkdyYXBoPE4sIEU+IHtcbiAgY29uc3QgZ3JhcGhPcHRpb25zID0gb3B0IHx8IHt9O1xuICBjb25zdCBncmFwaCA9IG5ldyBHcmFwaChncmFwaE9wdGlvbnMpO1xuICBncmFwaC5zZXRHcmFwaCh7XG4gICAgbmFtZTogbmFtZSxcbiAgICByYW5rZGlyOiBncmFwaE9wdGlvbnMucmFua2RpciB8fCAnQlQnLCAgLy8gQlQsVEIsTFIsUkxcbiAgICB0eXBlOiB0eXBlXG4gIH0gYXMgZ3JhcGhsaWIuR3JhcGhPcHRpb25zKTtcbiAgcmV0dXJuIChncmFwaCBhcyBhbnkpO1xufVxuIl19
